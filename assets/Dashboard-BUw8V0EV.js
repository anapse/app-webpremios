import{j as e,a as S,u as R}from"./index-BilUIvqZ.js";import{b as i}from"./vendor-DJKrsZSW.js";import{u as T}from"./useFetch-B8Cb0pGo.js";import"./pdf-C1-dEYVs.js";const P=s=>{const[m,d]=i.useState(!1),[h,r]=i.useState(null),[u,p]=i.useState(null);return{patchData:async(l,x)=>{if(!s||!l)return r("URL o ID no proporcionados"),null;d(!0),r(null);try{const o=await fetch(`${s}/${l}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(x)});if(!o.ok){const N=await o.json();throw new Error(N.error||"Error en la petici√≥n")}const f=await o.json();return p(f),d(!1),f}catch(o){return r(o.message),d(!1),null}},loading:m,error:h,data:u}},$=({sorteo:s,setSorteo:m})=>{const{patchData:d,loading:h,error:r}=P(S.sorteos),[u,p]=i.useState(""),[c,l]=i.useState("");i.useEffect(()=>{s?.nombre_sorteo&&p(s.nombre_sorteo)},[s]);const x=async()=>{if(l(""),!u.trim()){l("‚ùå El nombre no puede estar vac√≠o");return}if(!s?.id){l("‚ùå No hay sorteo seleccionado");return}const o=await d(s.id,{nombre_sorteo:u.trim()});o?(m(f=>({...f,nombre_sorteo:o.nombre_sorteo})),l("‚úÖ Nombre actualizado")):l("‚ùå "+(r||"Error desconocido"))};return h?e.jsx("p",{children:"Cargando..."}):r?e.jsxs("p",{children:["Error: ",r]}):e.jsxs("div",{className:"sorteo-nombre-container",children:[e.jsx("h3",{children:"üè∑ Nombre del Sorteo"}),e.jsx("input",{type:"text",value:u,onChange:o=>{p(o.target.value),l("")}}),e.jsx("button",{onClick:x,disabled:h,children:h?"Guardando...":"Guardar"}),c&&e.jsx("p",{className:"mensaje",children:c})]})},A=({sorteo:s,setSorteo:m})=>{const{patchData:d,loading:h,error:r}=P(S.sorteos),[u,p]=i.useState(""),[c,l]=i.useState("");i.useEffect(()=>{s?.ticket_price!==void 0&&p(Math.round(s.ticket_price))},[s]);const x=async()=>{if(l(""),!s?.id){l("‚ùå No hay sorteo seleccionado");return}const o=await d(s.id,{ticket_price:Number(u)});o?(m(f=>({...f,ticket_price:o.ticket_price})),l("‚úÖ Precio actualizado")):l("‚ùå "+(r||"Error desconocido"))};return s?e.jsxs("div",{className:"sorteo-precio-container",children:[e.jsx("h3",{children:"üíµ Precio del Ticket"}),e.jsx("input",{type:"number",value:u,onChange:o=>p(o.target.value)}),e.jsx("button",{onClick:x,disabled:h,children:h?"Guardando...":"Guardar"}),c&&e.jsx("p",{className:"mensaje",children:c})]}):e.jsx("p",{children:"Cargando..."})},G=({sorteo:s,setSorteo:m})=>{const[d,h]=i.useState(s?.sorteo_date?.split("T")[0]||""),{patchData:r,loading:u,error:p}=P(S.sorteos),[c,l]=i.useState("");i.useEffect(()=>{s?.sorteo_date&&h(s.sorteo_date.split("T")[0])},[s]);const x=async()=>{if(l(""),!s?.id){l("‚ùå No hay sorteo seleccionado");return}await r(s.id,{sorteo_date:new Date(d).toISOString()})?(m(f=>({...f,sorteo_date:new Date(d).toISOString()})),l("‚úÖ Fecha actualizada")):l("‚ùå "+(p||"Error desconocido"))};return e.jsxs("div",{className:"sorteo-fecha-container",children:[e.jsx("h3",{children:"üìÖ Fecha del Sorteo"}),e.jsx("input",{type:"date",value:d,onChange:o=>h(o.target.value)}),e.jsx("button",{onClick:x,disabled:u,children:u?"Guardando...":"Guardar"}),c&&e.jsx("p",{className:"mensaje",children:c})]})};function q(s){return s?new Date(s).toLocaleDateString("es-PE",{day:"2-digit",month:"2-digit",timeZone:"UTC"}):""}const z=({sorteo:s,setSorteo:m})=>{const{patchData:d,loading:h,error:r}=P(S.sorteos),[u,p]=i.useState(!1),[c,l]=i.useState("");i.useEffect(()=>{s?.estado_sorteo!==void 0&&p(!!s.estado_sorteo)},[s]);const x=async()=>{if(l(""),!s?.id){l("‚ùå No hay sorteo seleccionado");return}const o=await d(s.id,{estado_sorteo:u});o?(m(f=>({...f,estado_sorteo:o.estado_sorteo})),l("‚úÖ Estado actualizado")):l("‚ùå "+(r||"Error desconocido"))};return s?e.jsxs("div",{className:"sorteo-estado-container",children:[e.jsx("h3",{children:"üîò Estado del Sorteo"}),e.jsxs("div",{className:"descripcion-sorteo",children:[s?.nombre_sorteo," ‚Äî ",q(s?.sorteo_date)]}),e.jsxs("label",{htmlFor:"estado_sorteo",children:[e.jsx("input",{type:"checkbox",id:"estado_sorteo",checked:u,onChange:()=>p(!u)}),e.jsx("span",{className:"custom-checkbox",children:e.jsx("svg",{viewBox:"0 0 24 24",children:e.jsx("path",{d:"M20.285 6.709l-11.39 11.39-5.89-5.89 1.41-1.41 4.48 4.48 9.98-9.98z"})})})," ","Activo"]}),e.jsx("br",{}),e.jsx("button",{onClick:x,disabled:h,children:h?"Guardando...":"Guardar"}),c&&e.jsx("p",{className:"mensaje",children:c})]}):e.jsx("p",{children:"Cargando..."})};function L({precioDefault:s,onNuevoSorteoCreado:m}){const[d,h]=i.useState(!1),[r,u]=i.useState("Nuevo Sorteo"),[p,c]=i.useState(s||0),[l,x]=i.useState(new Date().toISOString().slice(0,10)),[o,f]=i.useState(!0),[N,_]=i.useState(""),{loading:b,error:n,postData:g}=R(S.sorteos),y=()=>r.trim()?!p||p<=0?(_("‚ùå El precio debe ser mayor a 0"),!1):l?!0:(_("‚ùå La fecha es obligatoria"),!1):(_("‚ùå El nombre del sorteo es obligatorio"),!1),w=async()=>{if(_(""),!!y())try{const v=await g({nombre_sorteo:r.trim(),ticket_price:parseFloat(p),sorteo_date:l,ganadores_total:0,estado_sorteo:o});v&&(_("‚úÖ Sorteo creado correctamente"),h(!1),u("Nuevo Sorteo"),c(s||0),x(new Date().toISOString().slice(0,10)),f(!0),m&&m(v))}catch(v){_("‚ùå "+v.message)}},k=()=>{h(!1),_(""),u("Nuevo Sorteo"),c(s||0),x(new Date().toISOString().slice(0,10)),f(!0)};return e.jsxs("div",{className:"crear-sorteo-form",children:[e.jsx("h3",{children:"üìù Nuevo Sorteo"}),d?e.jsxs("div",{className:"form-container",children:[e.jsx("input",{type:"text",value:r,onChange:v=>u(v.target.value),placeholder:"Nombre del sorteo",maxLength:"100"}),e.jsx("input",{type:"number",value:p,onChange:v=>c(v.target.value),placeholder:"Precio del ticket",min:"0",step:"0.01"}),e.jsx("input",{type:"date",value:l,onChange:v=>x(v.target.value),min:new Date().toISOString().slice(0,10)}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",checked:o,onChange:v=>f(v.target.checked)}),"üîò Activo"]}),e.jsxs("div",{className:"botones-accion",children:[e.jsx("button",{onClick:w,disabled:b,className:"btn-guardar",children:b?"Guardando...":"üíæ Guardar"}),e.jsx("button",{onClick:k,disabled:b,className:"btn-cancelar",children:"‚ùå Cancelar"})]}),N&&e.jsx("p",{className:"mensaje",children:N}),n&&e.jsxs("p",{className:"mensaje error",children:["‚ùå ",n]})]}):e.jsx("button",{onClick:()=>h(!0),className:"btn-crear",children:"+ Crear Nuevo Sorteo"})]})}const M=s=>{const[m,d]=i.useState(!1),[h,r]=i.useState(null);return{deleteData:async()=>null,loading:m,error:h}},B=({sorteo:s})=>{console.log("üîÑ PremiosEditor - Sorteo recibido:",s);const m=s?`${S.premios}?sorteo_id=${s.id}`:null;console.log("üåê URL construida para premios:",m);const{data:d,loading:h,error:r}=T(m);console.log("üì¶ Datos recibidos del fetch:",{data:d,loading:h,error:r});const{postData:u}=R(S.premios),{patchData:p}=P(S.premios);M();const[c,l]=i.useState([]),[x,o]=i.useState(""),[f,N]=i.useState(!1),[_,b]=i.useState(null),n=()=>Date.now()+Math.random();i.useEffect(()=>{if(console.log("üîÑ useEffect - Data cambi√≥:",d),d&&Array.isArray(d.premios)){console.log("‚úÖ Premios encontrados:",d.premios);const a=d.premios.map(t=>({...t,tempId:t.id||n()}));l(a)}else d&&(console.log("‚ö†Ô∏è Data no contiene array de premios:",d),l([]))},[d]);const g=(a,t,j)=>{if(t==="cantidad"&&Number(j)>99){o("‚ùå La cantidad no puede ser mayor a 99");return}l(C=>{const E=[...C];return E[a][t]=j,E}),o("")},y=()=>{l(a=>[...a,{id:null,tempId:n(),nombre:"",descripcion:"",cantidad:1,tipo_premio:1,sorteo_id:s.id,imagen_url:"",imagen_base64:""}]),o("")},w=async a=>{const t=c[a];if(t.id){if(!window.confirm(`¬øEst√°s seguro de que quieres eliminar "${t.nombre}"? Esta acci√≥n no se puede deshacer.`))return;b(t.id),o("üóëÔ∏è Eliminando premio...");try{console.log(`üóëÔ∏è Eliminando premio ${t.nombre} (ID: ${t.id})`);const C=`${S.premios}/${t.id}`;console.log("üåê URL de eliminaci√≥n:",C);const E=await fetch(C,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!E.ok){const D=await E.json().catch(()=>({}));throw new Error(D.error||`Error ${E.status}`)}const F=await E.json();console.log("‚úÖ Premio eliminado del servidor:",F),l(D=>D.filter((H,I)=>I!==a)),o(`‚úÖ Premio "${t.nombre}" eliminado correctamente`)}catch(C){console.error("‚ùå Error al eliminar premio:",C),o(`‚ùå Error al eliminar premio: ${C.message}`)}finally{b(null)}}else console.log(`üìù Removiendo premio temporal: ${t.nombre}`),l(j=>j.filter((C,E)=>E!==a)),o("Premio removido de la lista")},k=()=>{for(const a of c){if(!a.nombre||a.nombre.trim()==="")return o("‚ùå El nombre es obligatorio en todos los premios"),!1;if(!a.cantidad||a.cantidad<1||a.cantidad>99)return o("‚ùå La cantidad debe estar entre 1 y 99"),!1}return!0},v=async()=>{if(k()){o(""),N(!0),console.log("üíæ Iniciando guardado de premios:",c);try{const a=await Promise.all(c.map(async t=>{const{tempId:j,...C}=t;if(console.log(`üîÑ Procesando premio ${t.nombre}:`,{id:t.id,payload:C}),t.id){console.log("üìù Actualizando premio existente...");const E=await p(t.id,C);return console.log("‚úÖ Premio actualizado:",E),t}else{console.log("‚ûï Creando nuevo premio...");const E=await u(C);return console.log("‚úÖ Premio creado:",E),{...t,...E,tempId:t.tempId}}}));l(a),o("‚úÖ Premios guardados correctamente"),console.log("üéâ Todos los premios guardados exitosamente")}catch(a){console.error("‚ùå Error al guardar premios:",a),o(`‚ùå Error al guardar premios: ${a.message}`)}N(!1)}};return s?h?e.jsx("p",{children:"üîÑ Cargando premios..."}):r?e.jsxs("div",{className:"premios-editor-container",children:[e.jsx("h3",{children:"üéÅ Editor de Premios"}),e.jsxs("div",{className:"mensaje error",children:["‚ùå Error al cargar premios: ",r,e.jsx("br",{}),e.jsxs("small",{children:["URL: ",m]}),e.jsx("br",{}),e.jsx("button",{onClick:()=>window.location.reload(),children:"üîÑ Recargar p√°gina"})]})]}):e.jsxs("div",{className:"premios-editor-container",children:[e.jsx("h3",{children:"üéÅ Editor de Premios"}),e.jsxs("details",{style:{marginBottom:"10px",fontSize:"12px",color:"#666"},children:[e.jsx("summary",{children:"üîß Debug Info"}),e.jsx("pre",{children:JSON.stringify({sorteoId:s?.id,url:m,dataReceived:d,premiosCount:c.length,apiBaseUrl:S.premios},null,2)})]}),c.map((a,t)=>e.jsxs("div",{className:"premio-item",children:[e.jsxs("div",{className:"premio-columna",children:[e.jsx("div",{className:"premio-columna-titulo",children:"Nombre"}),e.jsx("input",{type:"text",placeholder:"Ej: iPhone 15 Pro",value:a.nombre,onChange:j=>g(t,"nombre",j.target.value)})]}),e.jsxs("div",{className:"premio-columna",children:[e.jsx("div",{className:"premio-columna-titulo",children:"Descripci√≥n"}),e.jsx("textarea",{className:"descripcion",placeholder:"Descripci√≥n detallada del premio...",value:a.descripcion||"",onChange:j=>g(t,"descripcion",j.target.value)})]}),e.jsxs("div",{className:"premio-columna",children:[e.jsx("div",{className:"premio-columna-titulo",children:"Cant"}),e.jsx("input",{type:"number",min:"1",max:"99",className:"cantidad",value:a.cantidad,onChange:j=>g(t,"cantidad",Number(j.target.value))})]}),e.jsxs("div",{className:"premio-columna",children:[e.jsx("div",{className:"premio-columna-titulo",children:"Imagen URL"}),e.jsx("input",{type:"url",placeholder:"https://...",className:"imagen-url",value:a.imagen_url||"",onChange:j=>g(t,"imagen_url",j.target.value)})]}),e.jsxs("div",{className:"premio-columna",children:[e.jsx("div",{className:"premio-columna-titulo",children:"Vista"}),(a.imagen_url||a.imagen_base64)&&e.jsx("div",{className:"imagen-preview",children:e.jsx("img",{src:a.imagen_base64||a.imagen_url,alt:"Preview",className:"preview-img",onError:j=>{j.target.style.display="none"}})})]}),e.jsxs("div",{className:"premio-columna",children:[e.jsx("div",{className:"premio-columna-titulo",children:"¬†"}),e.jsx("button",{className:"btn-eliminar",onClick:()=>w(t),disabled:_===a.id,title:a.id?"Eliminar premio de la base de datos":"Remover premio de la lista",children:_===a.id?"‚è≥":"√ó"})]})]},a.tempId)),e.jsxs("div",{className:"botonera",children:[e.jsx("button",{onClick:y,children:"‚ûï Agregar Premio"}),e.jsx("button",{onClick:v,disabled:f,children:f?"üíæ Guardando...":"üíæ Guardar Premios"})]}),x&&e.jsx("p",{className:"mensaje",children:x})]}):e.jsx("p",{children:"‚è≥ Esperando datos del sorteo..."})},U=()=>{const{data:s,loading:m,error:d,refetch:h}=T(S.homeBanner),[r,u]=i.useState({imagen_url:"",imagen_base64:""}),[p,c]=i.useState(""),[l,x]=i.useState(!1),[o,f]=i.useState(240);i.useEffect(()=>{console.log("üîç Hook useFetch - Estado actual:",{data:s,loading:m,error:d}),s?.banner&&(console.log("‚úÖ Banner recibido:",s.banner),u(n=>({...n,imagen_url:s.banner.imagen_url||"",imagen_base64:s.banner.imagen_base64||""})))},[s]);const N=(n,g)=>{u(y=>({...y,[n]:g})),c("")},_=n=>{const g=n.target.files[0];if(g){if(g.size>2*1024*1024){c("‚ùå La imagen debe ser menor a 2MB. Actual: "+(g.size/1024/1024).toFixed(1)+"MB"),n.target.value="";return}if(!g.type.startsWith("image/")){c("‚ùå Solo se permiten archivos de imagen"),n.target.value="";return}c("üîÑ Procesando imagen...");const y=new FileReader;y.onload=w=>{const k=w.target.result;if(k.length*.75>2*1024*1024){c("‚ùå La imagen codificada es demasiado grande. Intenta con una imagen m√°s peque√±a."),n.target.value="";return}u(a=>({...a,imagen_base64:k,imagen_url:""})),c("‚úÖ Imagen cargada correctamente ("+(g.size/1024).toFixed(0)+"KB)")},y.onerror=()=>{c("‚ùå Error al leer la imagen"),n.target.value=""},y.readAsDataURL(g)}},b=async()=>{x(!0),c("");try{console.log("üîÑ Enviando datos del banner:",r),console.log("üîÑ URL del API:",S.homeBanner);const n=await fetch(S.homeBanner,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});console.log("üì° Respuesta del servidor:",n.status,n.statusText);const g=await n.json();console.log("üì¶ Datos recibidos:",g),n.ok?(c("‚úÖ Banner guardado correctamente"),u(g.banner),h()):(console.error("‚ùå Error del servidor:",g),c(`‚ùå Error: ${g.error||"Error desconocido"}`))}catch(n){console.error("‚ùå Error al guardar banner:",n),c(`‚ùå Error al guardar banner: ${n.message}`)}x(!1)};return m?e.jsx("div",{className:"loading",children:"üîÑ Cargando banner..."}):d?e.jsxs("div",{className:"banner-editor-container",children:[e.jsx("h3",{children:"üñºÔ∏è Editor de Banner Principal"}),e.jsxs("div",{className:"mensaje error",children:["‚ö†Ô∏è El banner no est√° disponible en este momento.",e.jsx("br",{}),e.jsx("small",{children:"Es necesario ejecutar el script de base de datos para esta funcionalidad."})]})]}):e.jsxs("div",{className:"banner-editor-container",children:[e.jsx("h3",{children:"üñºÔ∏è Editor de Banner Principal"}),e.jsx("p",{className:"editor-description",children:"Configura el banner principal que se muestra en la p√°gina de inicio"}),e.jsxs("div",{className:"banner-form",children:[e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"imagen_url",children:"URL de Imagen del Banner"}),e.jsx("input",{id:"imagen_url",type:"url",placeholder:"https://ejemplo.com/banner.jpg",value:r.imagen_url||"",onChange:n=>N("imagen_url",n.target.value)}),e.jsxs("small",{className:"form-help",children:["üí° ",e.jsx("strong",{children:"Recomendado:"})," Usa URLs de im√°genes externas para evitar l√≠mites de tama√±o",e.jsx("br",{}),"üìê Tama√±o ideal: 1200x400px | üåê Ejemplos: Unsplash, Imgur, etc."]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"imagen_file",children:"Subir Imagen del Banner"}),e.jsx("input",{id:"imagen_file",type:"file",accept:"image/*",onChange:_}),e.jsx("small",{className:"form-help",children:"üìÅ Selecciona una imagen desde tu computadora (m√°x. 2MB). Formatos: JPG, PNG, GIF."})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"preview_height",children:["Altura de Vista Previa: ",o,"px"]}),e.jsx("input",{id:"preview_height",type:"range",min:"180",max:"600",step:"10",value:o,onChange:n=>f(Number(n.target.value))}),e.jsx("small",{className:"form-help",children:"Solo afecta la vista previa del editor."})]}),(r.imagen_url||r.imagen_base64)&&e.jsxs("div",{className:"banner-preview",children:[e.jsx("h4",{children:"Vista Previa del Banner:"}),e.jsx("div",{className:"preview-container",children:e.jsx("img",{src:r.imagen_base64||r.imagen_url,alt:"Preview del banner",className:"banner-preview-img",style:{maxHeight:`${o}px`},onError:n=>{n.target.src="/placeholder-banner.svg"}})})]}),e.jsx("div",{className:"banner-actions",children:e.jsx("button",{onClick:b,disabled:l,className:"btn-save",children:l?"üíæ Guardando...":"üíæ Guardar Banner"})}),p&&e.jsx("div",{className:"mensaje",children:p})]})]})},O=()=>{const[s,m]=i.useState([]),[d,h]=i.useState(!1),[r,u]=i.useState(null),[p,c]=i.useState(!1),[l,x]=i.useState(""),[o,f]=i.useState("pendiente"),[N,_]=i.useState("cards"),b=[{value:"pendiente",label:"‚è≥ Pendientes",count:0},{value:"pagado",label:"‚úÖ Aceptados",count:0},{value:"rechazado",label:"‚ùå Rechazados",count:0},{value:"todos",label:"üìã Todos",count:0}],n=async(a=o)=>{h(!0);try{console.log(`üîÑ Cargando tickets con estado: ${a}`);const t=await fetch(`/api/config/tickets?status=${a}`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const j=await t.json();console.log("üì¶ Datos recibidos del fetch:",j),j.error&&j.tickets?(console.warn("‚ö†Ô∏è Error en backend pero se recibi√≥ array:",j.error),m(j.tickets),x("‚ö†Ô∏è Problema al cargar tickets. Verifique la configuraci√≥n de la base de datos.")):Array.isArray(j)?(m(j),x("")):(console.error("‚ùå Respuesta no es un array:",j),m([]),x("‚ùå Error: Respuesta inv√°lida del servidor"))}catch(t){console.error("‚ùå Error al cargar tickets:",t),m([]),x("‚ùå Error de conexi√≥n. Verifique que el servidor est√© funcionando.")}finally{h(!1)}};i.useEffect(()=>{n()},[o]);const g=a=>{f(a),n(a)},y=async a=>{try{const t=await fetch(`/api/tickets/${a}/activate`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({estado_pago:"pagado"})}),j=await t.json();t.ok?(alert(`‚úÖ ${j.message}`),n(),c(!1)):alert(`‚ùå Error: ${j.error}`)}catch(t){console.error("Error al activar ticket:",t),alert("Error de conexi√≥n")}},w=async a=>{try{const t=await fetch(`/api/tickets/${a}/activate`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({estado_pago:"rechazado"})}),j=await t.json();t.ok?(alert(`‚úÖ Ticket rechazado: ${j.codigo_ticket}`),n(),c(!1)):alert(`‚ùå Error: ${j.error}`)}catch(t){console.error("Error al rechazar ticket:",t),alert("Error de conexi√≥n")}},k=a=>{switch(a){case"pendiente":return{text:"PEND.",class:"pending"};case"pagado":return{text:"ACEPT.",class:"accepted"};case"rechazado":return{text:"RECH.",class:"rejected"};default:return{text:a.toUpperCase().substr(0,6),class:"unknown"}}},v=a=>{u(a),c(!0)};return e.jsxs("div",{className:"tickets-manager",children:[e.jsxs("div",{className:"manager-header",children:[e.jsx("h3",{children:"üìã Gesti√≥n de Tickets"}),e.jsxs("div",{className:"header-controls",children:[e.jsx("select",{value:o,onChange:a=>g(a.target.value),className:"status-filter",children:b.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))}),e.jsx("div",{className:"view-toggle",children:e.jsxs("label",{className:"switch",children:[e.jsx("input",{type:"checkbox",checked:N==="list",onChange:a=>_(a.target.checked?"list":"cards")}),e.jsx("span",{className:"slider",children:e.jsxs("span",{className:"switch-label",children:[N==="cards"?"üìã":"üî≤"," ",N==="cards"?"Lista":"Tarjetas"]})})]})}),e.jsx("button",{onClick:()=>n(),className:"btn-refresh",children:"üîÑ Actualizar"})]})]}),l&&e.jsx("div",{className:`tickets-message ${l.includes("‚ùå")?"error":"warning"}`,children:l}),d?e.jsx("div",{className:"loading",children:"Cargando tickets..."}):e.jsx("div",{className:N==="cards"?"tickets-grid":"tickets-list",children:s.length===0?e.jsxs("div",{className:"no-tickets",children:[o==="pendiente"&&"‚úÖ No hay tickets pendientes",o==="pagado"&&"üì≠ No hay tickets aceptados",o==="rechazado"&&"üì≠ No hay tickets rechazados",o==="todos"&&"üì≠ No hay tickets registrados"]}):N==="cards"?s.map(a=>{const t=k(a.estado_pago);return e.jsxs("div",{className:"ticket-card",children:[e.jsxs("div",{className:"ticket-header",children:[e.jsx("h4",{children:a.codigo_ticket}),e.jsx("span",{className:`ticket-status ${t.class}`,children:t.text})]}),e.jsxs("div",{className:"ticket-info",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Nombre:"})," ",a.nombres," ",a.apellidos]}),e.jsxs("p",{children:[e.jsx("strong",{children:"DNI:"})," ",a.dni]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Tel√©fono:"})," ",a.telefono]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Departamento:"})," ",a.departamento]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Fecha:"})," ",new Date(a.fecha).toLocaleString()]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Precio:"})," S/ ",a.ticket_price]})]}),e.jsx("div",{className:"ticket-actions",children:e.jsx("button",{onClick:()=>v(a),className:"btn-details",children:"üëÅÔ∏è Ver Detalles"})})]},a.id)}):e.jsxs("div",{className:"tickets-table",children:[e.jsxs("div",{className:"table-header",children:[e.jsx("div",{className:"table-cell",children:"C√≥digo"}),e.jsx("div",{className:"table-cell",children:"Nombre"}),e.jsx("div",{className:"table-cell",children:"DNI"}),e.jsx("div",{className:"table-cell",children:"Tel√©fono"}),e.jsx("div",{className:"table-cell",children:"Departamento"}),e.jsx("div",{className:"table-cell",children:"Estado"}),e.jsx("div",{className:"table-cell",children:"Fecha"}),e.jsx("div",{className:"table-cell",children:"Precio"}),e.jsx("div",{className:"table-cell",children:"Acciones"})]}),s.map(a=>{const t=k(a.estado_pago);return e.jsxs("div",{className:"table-row",children:[e.jsx("div",{className:"table-cell",children:a.codigo_ticket}),e.jsxs("div",{className:"table-cell",children:[a.nombres," ",a.apellidos]}),e.jsx("div",{className:"table-cell",children:a.dni}),e.jsx("div",{className:"table-cell",children:a.telefono}),e.jsx("div",{className:"table-cell",children:a.departamento}),e.jsx("div",{className:"table-cell",children:e.jsx("span",{className:`ticket-status ${t.class}`,children:t.text})}),e.jsx("div",{className:"table-cell",children:new Date(a.fecha).toLocaleDateString()}),e.jsxs("div",{className:"table-cell",children:["S/ ",a.ticket_price]}),e.jsx("div",{className:"table-cell",children:e.jsx("button",{onClick:()=>v(a),className:"btn-details-small",children:"üëÅÔ∏è"})})]},a.id)})]})}),p&&r&&e.jsx("div",{className:"modal-overlay",onClick:()=>c(!1),children:e.jsxs("div",{className:"modal-content large",onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h3",{children:["üé´ Ticket: ",r.codigo_ticket]}),e.jsx("button",{className:"modal-close",onClick:()=>c(!1),children:"√ó"})]}),e.jsx("div",{className:"modal-body",children:e.jsxs("div",{className:"ticket-details",children:[e.jsxs("div",{className:"details-section",children:[e.jsx("h4",{children:"üìã Datos del Participante"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Nombre:"})," ",r.nombres," ",r.apellidos]}),e.jsxs("p",{children:[e.jsx("strong",{children:"DNI:"})," ",r.dni]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Tel√©fono:"})," ",r.telefono]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Departamento:"})," ",r.departamento]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Fecha de registro:"})," ",new Date(r.fecha).toLocaleString()]})]}),e.jsxs("div",{className:"details-section",children:[e.jsx("h4",{children:"üí∞ Informaci√≥n del Pago"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Monto:"})," S/ ",r.ticket_price]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Estado:"}),e.jsx("span",{className:`status-${k(r.estado_pago).class}`,children:k(r.estado_pago).text})]})]}),r.comprobante_base64&&e.jsxs("div",{className:"details-section",children:[e.jsx("h4",{children:"üì∑ Comprobante de Pago"}),e.jsx("div",{className:"comprobante-container",children:e.jsx("img",{src:r.comprobante_base64,alt:"Comprobante de pago",className:"comprobante-image"})})]})]})}),e.jsxs("div",{className:"modal-actions",children:[r.estado_pago==="pendiente"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>w(r.id),className:"btn-reject",children:"‚ùå Rechazar"}),e.jsx("button",{onClick:()=>y(r.id),className:"btn-activate",children:"‚úÖ Activar Ticket"})]}),r.estado_pago==="pagado"&&e.jsx("div",{className:"status-info accepted",children:"‚úÖ Este ticket ya est√° activado"}),r.estado_pago==="rechazado"&&e.jsx("div",{className:"status-info rejected",children:"‚ùå Este ticket fue rechazado"})]})]})})]})},V=()=>{const[s,m]=i.useState({telefono_notificaciones:"",telefono_pagos:"",nombre_beneficiario_yape:"",qr_pago_base64:"",qr_pago_url:"",mensaje_whatsapp_template:""}),[d,h]=i.useState(!1),[r,u]=i.useState(!1),[p,c]=i.useState(""),[l,x]=i.useState(null),o=async()=>{h(!0);try{const n=await(await fetch("/api/config")).json();m(n)}catch(b){console.error("Error al cargar configuraci√≥n:",b),c("‚ùå Error al cargar configuraci√≥n")}finally{h(!1)}};i.useEffect(()=>{o()},[]);const f=b=>{const{name:n,value:g}=b.target;m(y=>({...y,[n]:g}))},N=b=>{const n=b.target.files[0];if(n){if(!n.type.startsWith("image/")){alert("Por favor selecciona solo archivos de imagen"),b.target.value="";return}if(n.size>2*1024*1024){alert("La imagen no debe superar los 2MB"),b.target.value="";return}x(n);const g=new FileReader;g.onload=()=>{m(y=>({...y,qr_pago_base64:g.result}))},g.readAsDataURL(n)}},_=async b=>{b.preventDefault(),u(!0),c("");try{const n=await fetch("/api/config",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),g=await n.json();n.ok?(c("‚úÖ Configuraci√≥n guardada exitosamente"),m(g.config)):c(`‚ùå Error: ${g.error}`)}catch(n){console.error("Error al guardar configuraci√≥n:",n),c("‚ùå Error de conexi√≥n")}finally{u(!1)}};return d?e.jsx("div",{className:"system-config",children:e.jsx("div",{className:"loading",children:"Cargando configuraci√≥n..."})}):e.jsxs("div",{className:"system-config",children:[e.jsxs("div",{className:"config-header",children:[e.jsx("h3",{children:"‚öôÔ∏è Configuraci√≥n del Sistema"}),e.jsx("p",{children:"Administra los n√∫meros de tel√©fono y el QR de pagos"})]}),p&&e.jsx("div",{className:`config-message ${p.includes("‚ùå")?"error":"success"}`,children:p}),e.jsxs("form",{onSubmit:_,className:"config-form",children:[e.jsxs("div",{className:"config-sections",children:[e.jsxs("div",{className:"config-section",children:[e.jsx("h4",{children:"üì± Configuraci√≥n de Tel√©fonos"}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"nombre_beneficiario_yape",children:["Nombre del Beneficiario:",e.jsx("span",{className:"help-text",children:"Nombre que aparecer√° junto al n√∫mero para identificar al beneficiario"})]}),e.jsx("input",{type:"text",id:"nombre_beneficiario_yape",name:"nombre_beneficiario_yape",value:s.nombre_beneficiario_yape,onChange:f,placeholder:"Ej: Juan P√©rez",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"telefono_notificaciones",children:["WhatsApp para Notificaciones:",e.jsx("span",{className:"help-text",children:"N√∫mero donde se enviar√°n los tickets para verificaci√≥n"})]}),e.jsx("input",{type:"text",id:"telefono_notificaciones",name:"telefono_notificaciones",value:s.telefono_notificaciones,onChange:f,placeholder:"Ej: 51912391502",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"telefono_pagos",children:["N√∫mero para Pagos:",e.jsx("span",{className:"help-text",children:"N√∫mero que aparecer√° en el formulario para recibir pagos"})]}),e.jsx("input",{type:"text",id:"telefono_pagos",name:"telefono_pagos",value:s.telefono_pagos,onChange:f,placeholder:"Ej: 51987654321",required:!0})]})]}),e.jsxs("div",{className:"config-section",children:[e.jsx("h4",{children:"üì∑ C√≥digo QR de Pago"}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"qr_upload",children:["Subir nueva imagen QR:",e.jsx("span",{className:"help-text",children:"Imagen que se mostrar√° en el formulario de registro"})]}),e.jsx("input",{type:"file",id:"qr_upload",accept:"image/*",onChange:N})]}),s.qr_pago_base64&&e.jsxs("div",{className:"qr-preview",children:[e.jsx("h5",{children:"Vista previa del QR:"}),e.jsx("img",{src:s.qr_pago_base64,alt:"QR de pago",className:"qr-image"})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"qr_pago_url",children:["URL del QR (opcional):",e.jsx("span",{className:"help-text",children:"Si prefieres usar una URL en lugar de subir archivo"})]}),e.jsx("input",{type:"url",id:"qr_pago_url",name:"qr_pago_url",value:s.qr_pago_url,onChange:f,placeholder:"https://ejemplo.com/qr-yape.jpg"})]})]}),e.jsxs("div",{className:"config-section",children:[e.jsx("h4",{children:"üí¨ Template de Mensaje WhatsApp"}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{htmlFor:"mensaje_whatsapp_template",children:["Plantilla del mensaje:",e.jsxs("span",{className:"help-text",children:["Variables disponibles: ","{nombres}",", ","{apellidos}",", ","{dni}",", ","{telefono}",", ","{departamento}",", ","{codigo_ticket}",", ","{precio}"]})]}),e.jsx("textarea",{id:"mensaje_whatsapp_template",name:"mensaje_whatsapp_template",value:s.mensaje_whatsapp_template,onChange:f,rows:"8",placeholder:"Escribe el template del mensaje...",required:!0})]})]})]}),e.jsxs("div",{className:"config-actions",children:[e.jsx("button",{type:"button",onClick:o,className:"btn-reload",disabled:r,children:"üîÑ Recargar"}),e.jsx("button",{type:"submit",className:"btn-save",disabled:r,children:r?"Guardando...":"üíæ Guardar Configuraci√≥n"})]})]})]})},Z=()=>{const[s,m]=i.useState(null),[d,h]=i.useState("sorteo"),{data:r,loading:u,error:p}=T(S.proximoSorteo);i.useEffect(()=>{r&&m(r)},[r]);const c=async()=>{try{const l=await fetch(S.proximoSorteo);if(!l.ok)throw new Error("Error al recargar el sorteo");const x=await l.json();m(x)}catch(l){console.error(l)}};return u?e.jsx("p",{children:"Cargando..."}):p?e.jsxs("p",{children:["Error: ",p]}):e.jsxs("div",{className:"dashboard-container",children:[e.jsx("h1",{children:"Panel de Administraci√≥n"}),e.jsxs("div",{className:"dashboard-tabs",children:[e.jsx("button",{className:d==="sorteo"?"tab-active":"tab",onClick:()=>h("sorteo"),children:"üé≤ Gesti√≥n de Sorteos"}),e.jsx("button",{className:d==="premios"?"tab-active":"tab",onClick:()=>h("premios"),children:"üèÜ Gesti√≥n de Premios"}),e.jsx("button",{className:d==="tickets"?"tab-active":"tab",onClick:()=>h("tickets"),children:"üé´ Gesti√≥n de Tickets"}),e.jsx("button",{className:d==="config"?"tab-active":"tab",onClick:()=>h("config"),children:"‚öôÔ∏è Configuraci√≥n"})]}),d==="sorteo"&&s&&e.jsxs("div",{className:"dashboard-section",children:[e.jsx(L,{precioDefault:s?.ticket_price,onNuevoSorteoCreado:c}),e.jsx($,{sorteo:s,setSorteo:m}),e.jsx(A,{sorteo:s,setSorteo:m}),e.jsx(G,{sorteo:s,setSorteo:m}),e.jsx(z,{sorteo:s,setSorteo:m})]}),d==="premios"&&s&&e.jsxs("div",{className:"premios-section",children:[e.jsx(B,{sorteo:s,setSorteo:m}),e.jsx(U,{})]}),d==="tickets"&&e.jsx("div",{className:"dashboard-section",children:e.jsx(O,{})}),d==="config"&&e.jsx("div",{className:"dashboard-section",children:e.jsx(V,{})})]})};export{Z as default};
