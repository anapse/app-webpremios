<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Niubiz Return</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .test-section {
            border: 1px solid #ddd;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 10px 5px;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background: #0056b3;
        }
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>üß™ Test Niubiz Return Flow</h1>
    
    <div class="warning">
        <strong>‚ö†Ô∏è Importante:</strong> Esta p√°gina simula diferentes tipos de retorno que puede enviar Niubiz.
        Usa estos tests para verificar que el componente NiubizReturn maneja correctamente todos los casos.
    </div>

    <div class="test-section">
        <h2>üéØ Test 1: Retorno Exitoso con Par√°metros URL</h2>
        <p>Simula un retorno exitoso de Niubiz con todos los par√°metros necesarios.</p>
        <button onclick="testSuccessReturn()">Probar Retorno Exitoso</button>
        <pre id="success-params"></pre>
    </div>

    <div class="test-section">
        <h2>‚ùå Test 2: Retorno con Error</h2>
        <p>Simula un retorno con error de Niubiz.</p>
        <button onclick="testErrorReturn()">Probar Retorno con Error</button>
        <pre id="error-params"></pre>
    </div>

    <div class="test-section">
        <h2>üì≠ Test 3: Retorno Sin Par√°metros</h2>
        <p>Simula un retorno de Niubiz sin par√°metros (caso problem√°tico actual).</p>
        <button onclick="testEmptyReturn()">Probar Retorno Vac√≠o</button>
        <pre id="empty-params"></pre>
    </div>

    <div class="test-section">
        <h2>üîß Test 4: Retorno con SessionStorage</h2>
        <p>Simula datos guardados en sessionStorage para casos donde la URL no trae par√°metros.</p>
        <button onclick="testSessionStorageReturn()">Probar con SessionStorage</button>
        <pre id="storage-params"></pre>
    </div>

    <script>
        const baseUrl = 'http://localhost:5173/app-webpremios/pay';
        
        function testSuccessReturn() {
            const params = {
                transactionToken: 'abc123def456ghi789jkl012mno345pqr',
                purchaseNumber: '1703123456789',
                amount: '15.00',
                actionCode: '000',
                authorizationCode: 'AUTH123456'
            };
            
            document.getElementById('success-params').textContent = JSON.stringify(params, null, 2);
            
            const url = `${baseUrl}?${new URLSearchParams(params)}`;
            console.log('üéØ Abriendo URL de √©xito:', url);
            window.open(url, '_blank');
        }
        
        function testErrorReturn() {
            const params = {
                errorCode: '101',
                actionCode: '101',
                amount: '15.00'
            };
            
            document.getElementById('error-params').textContent = JSON.stringify(params, null, 2);
            
            const url = `${baseUrl}?${new URLSearchParams(params)}`;
            console.log('‚ùå Abriendo URL de error:', url);
            window.open(url, '_blank');
        }
        
        function testEmptyReturn() {
            document.getElementById('empty-params').textContent = 'Sin par√°metros - URL limpia';
            
            console.log('üì≠ Abriendo URL vac√≠a:', baseUrl);
            window.open(baseUrl, '_blank');
        }
        
        function testSessionStorageReturn() {
            const mockData = {
                transactionToken: 'stored123def456ghi789jkl012mno345xyz',
                purchaseNumber: '1703123456999',
                amount: '15.00',
                source: 'sessionStorage_test'
            };
            
            document.getElementById('storage-params').textContent = JSON.stringify(mockData, null, 2);
            
            // Simular que se guarda en sessionStorage
            localStorage.setItem('test_storage', JSON.stringify(mockData));
            
            // Abrir una ventana que puede usar este dato
            const storageTestUrl = `${baseUrl}?test=storage`;
            console.log('üîß Abriendo URL con sessionStorage:', storageTestUrl);
            
            // Programar que se ejecute c√≥digo para simular sessionStorage en la nueva ventana
            const newWindow = window.open(storageTestUrl, '_blank');
            
            setTimeout(() => {
                if (newWindow && !newWindow.closed) {
                    try {
                        newWindow.sessionStorage.setItem('niubizTransaction', JSON.stringify(mockData));
                        console.log('‚úÖ SessionStorage configurado en nueva ventana');
                    } catch (e) {
                        console.log('‚ö†Ô∏è No se pudo configurar sessionStorage:', e.message);
                    }
                }
            }, 1000);
        }
        
        // Informaci√≥n de depuraci√≥n
        console.log('üß™ Test Niubiz Return cargado');
        console.log('üéØ URL base para tests:', baseUrl);
    </script>
</body>
</html>
