import{a as _,j as e}from"./index-BcMqhxv5.js";import{b as r}from"./vendor-DJKrsZSW.js";import{E as I}from"./pdf-C1-dEYVs.js";import{d as P}from"./RegistroInfo-CLtfe4US.js";import{u as k}from"./useFetch-B8Cb0pGo.js";const q=()=>{const{data:n}=k(_.proximoSorteo),{data:x}=k("/api/config"),[N,b]=r.useState({days:0,hours:0,mins:0,secs:0}),[t,i]=r.useState({dni:"",nombres:"",apellidos:"",telefono:"",departamento:"",mayorEdad:!1}),[l,m]=r.useState(null),[d,v]=r.useState(null),[u,g]=r.useState(!1),[h,j]=r.useState("");r.useEffect(()=>{if(!n||!n.sorteo_date)return;const a=new Date(n.sorteo_date),o=setInterval(()=>{const s=a-new Date;if(s<=0){clearInterval(o),b({days:0,hours:0,mins:0,secs:0});return}const c=Math.floor(s/(1e3*60*60*24)),E=Math.floor(s/(1e3*60*60)%24),T=Math.floor(s/(1e3*60)%60),A=Math.floor(s/1e3%60);b({days:c,hours:E,mins:T,secs:A})},1e3);return()=>clearInterval(o)},[n]);const p=a=>{const{name:o,value:f,type:s,checked:c}=a.target;i(E=>({...E,[o]:s==="checkbox"?c:f}))},C=a=>{const o=a.target.files[0];if(o){if(!o.type.startsWith("image/")){alert("Por favor selecciona solo archivos de imagen"),a.target.value="";return}if(o.size>5*1024*1024){alert("La imagen no debe superar los 5MB"),a.target.value="";return}m(o)}},y=a=>{let o=x?.mensaje_whatsapp_template||`🎫 *NUEVO TICKET REGISTRADO*

*Datos del participante:*
👤 Nombre: {nombres} {apellidos}
🆔 DNI: {dni}
📱 WhatsApp: {telefono}
📍 Departamento: {departamento}
🎟️ Código de ticket: {codigo_ticket}
💰 Monto: S/ {precio}

⚠️ *TICKET PENDIENTE DE ACTIVACIÓN*
El ticket está desactivado hasta verificar el comprobante.

#GameZtore #Ticket #{codigo_ticket}`;o=o.replace(/{nombres}/g,t.nombres).replace(/{apellidos}/g,t.apellidos).replace(/{dni}/g,t.dni).replace(/{telefono}/g,t.telefono).replace(/{departamento}/g,t.departamento).replace(/{codigo_ticket}/g,a.codigo_ticket).replace(/{precio}/g,n?.ticket_price||15);const s=`https://wa.me/${x?.telefono_notificaciones||"51000000000"}?text=${encodeURIComponent(o)}`;window.open(s,"_blank")},D=async a=>{if(a.preventDefault(),!t.mayorEdad){alert("Debes confirmar que eres mayor de edad");return}if(!l){alert("Debes subir el comprobante de pago");return}g(!0),j("Registrando ticket...");try{const o=new FileReader;o.onload=async()=>{const f=o.result,s=await fetch("/api/tickets",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...t,comprobante_base64:f,estado_pago:"pendiente",id_transaccion:`MANUAL_${Date.now()}`,token_yape:`MANUAL_${t.dni}_${Date.now()}`})}),c=await s.json();s.ok?(v(c.codigo_ticket),j("✅ Ticket registrado exitosamente"),setTimeout(()=>{y(c)},1e3)):j(`❌ Error: ${c.error||"No se pudo registrar el ticket"}`)},o.readAsDataURL(l)}catch(o){console.error("Error al registrar ticket:",o),j("❌ Error de conexión. Intenta nuevamente.")}finally{g(!1)}},S=()=>{const a=new I;a.setFontSize(16),a.text("🎫 Ticket Game Ztore",20,30),a.setFontSize(12),a.text(`Nombre: ${t.nombres} ${t.apellidos}`,20,45),a.text(`DNI: ${t.dni}`,20,55),a.text(`Teléfono: ${t.telefono}`,20,65),a.text(`Departamento: ${t.departamento}`,20,75),a.text(`Código de Ticket: ${d}`,20,85),a.text("Estado: PENDIENTE DE ACTIVACIÓN",20,95),a.text(`Fecha: ${new Date().toLocaleDateString()}`,20,105),a.save(`${d}_PENDIENTE.pdf`)};return e.jsx("section",{className:"registro-form",children:e.jsxs("div",{className:"form-container",children:[e.jsx("h2",{children:"Registro de Ticket"}),d?e.jsxs("div",{className:"resultado-ticket",children:[e.jsx("p",{children:"🎉 ¡Ticket registrado exitosamente!"}),e.jsx("p",{children:"Tu número de ticket es:"}),e.jsx("h3",{children:d}),e.jsxs("div",{className:"ticket-status",children:[e.jsx("p",{className:"pending-status",children:"⏳ ESTADO: PENDIENTE DE ACTIVACIÓN"}),e.jsxs("p",{className:"info-text",children:["Tu ticket será activado después de verificar el comprobante de pago.",e.jsx("br",{}),"Te notificaremos por WhatsApp cuando esté listo."]})]}),e.jsx("button",{onClick:S,className:"btn-download",children:"📄 Descargar PDF (Pendiente)"})]}):e.jsxs("form",{onSubmit:D,children:[h&&e.jsx("div",{className:`submit-message ${h.includes("❌")?"error":"success"}`,children:h}),e.jsx("input",{name:"dni",placeholder:"DNI o C. de Extranjería",value:t.dni,onChange:p,required:!0}),e.jsx("input",{name:"nombres",placeholder:"Nombres",value:t.nombres,onChange:p,required:!0}),e.jsx("input",{name:"apellidos",placeholder:"Apellidos",value:t.apellidos,onChange:p,required:!0}),e.jsx("input",{name:"telefono",placeholder:"Número WhatsApp",value:t.telefono,onChange:p,required:!0}),e.jsxs("select",{name:"departamento",value:t.departamento,onChange:p,required:!0,children:[e.jsx("option",{value:"",children:"Selecciona Departamento"}),P.map(a=>e.jsx("option",{value:a,children:a},a))]}),e.jsxs("label",{className:"checkbox-label",children:[e.jsx("input",{type:"checkbox",name:"mayorEdad",checked:t.mayorEdad,onChange:p,required:!0}),"Confirmo que soy mayor de edad"]}),e.jsxs("div",{className:"file-upload",children:[e.jsx("label",{htmlFor:"comprobante",children:"📷 Subir comprobante de pago (YAPE/BCP):"}),e.jsx("input",{type:"file",id:"comprobante",accept:"image/*",onChange:C,required:!0}),l&&e.jsxs("p",{className:"file-selected",children:["✅ Archivo seleccionado: ",l.name]})]}),e.jsx("button",{type:"submit",className:"btn-submit",disabled:u,children:u?"Enviando...":"🚀 Enviar Registro"})]}),e.jsx("div",{className:"contador",children:[{key:"days",label:"Días"},{key:"hours",label:"Horas"},{key:"mins",label:"Minutos"},{key:"secs",label:"Segundos"}].map(({key:a,label:o})=>e.jsxs("div",{className:"unidad",children:[e.jsx("div",{className:"numero",children:String(N[a]).padStart(2,"0")}),e.jsx("div",{className:"texto",children:o})]},a))})]})})},w=()=>{const{data:n,loading:x,error:N}=k(_.proximoSorteo),[b,t]=r.useState(null),[i,l]=r.useState({telefono_pagos:"000 000 000",qr_pago_base64:"",qr_pago_url:"",nombre_beneficiario_yape:"Nombre del Beneficiario"}),[m,d]=r.useState(!0);r.useEffect(()=>{(async()=>{try{const h=await(await fetch("/api/config")).json();l(h)}catch(g){console.error("Error al cargar configuración:",g)}finally{d(!1)}})()},[]),r.useEffect(()=>{n&&n.ticket_price!==void 0&&t(n.ticket_price)},[n]);const v=()=>i.qr_pago_base64?i.qr_pago_base64:i.qr_pago_url?i.qr_pago_url:"/yape-qr-placeholder.svg";return e.jsx("section",{className:"registro-info",children:e.jsxs("div",{className:"info-container",children:[e.jsx("h2",{children:"¿Cómo Participar?"}),e.jsxs("div",{className:"paso-container",children:[e.jsx("p",{className:"paso",children:"PASO 1: Realiza el pago al número:"}),e.jsxs("div",{className:"numero-container",children:[e.jsx("p",{className:"numero",children:m?"Cargando...":i.telefono_pagos}),e.jsx("p",{className:"beneficiario",children:m?"Cargando...":i.nombre_beneficiario_yape})]}),e.jsx("div",{className:"qr-container",children:!m&&e.jsx("img",{src:v(),alt:"Código QR de pago",className:"qr-image",onError:u=>{u.target.src="/yape-qr-placeholder.svg"}})}),e.jsxs("div",{className:"precio-container",children:[e.jsx("p",{className:"costo",children:"Costo del ticket"}),e.jsx("p",{className:"precio",children:e.jsx("strong",{children:x?"Cargando...":N?"Error al cargar":`S/ ${b}`})})]})]}),e.jsxs("div",{className:"paso-container",children:[e.jsxs("p",{className:"paso2",children:["PASO 2: Rellena el formulario con tus datos y sube tu captura de YAPE/PLIN/BCP",e.jsx("br",{}),e.jsx("span",{className:"paso2-destacado",children:"📋 Aquí abajo"})]}),e.jsx("div",{className:"flecha",children:e.jsx("strong",{children:"↓"})})]})]})})},W=()=>e.jsxs("div",{children:[e.jsx(w,{}),e.jsx(q,{})]});export{W as default};
